# Домашнее задание к занятию "`Компоненты Kubernetes`" - `Исаенков Евгений`

### Цель задания

Рассчитать требования к кластеру под проект

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 Gb RAM в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 Gb RAM в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 Mb RAM на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 Mb RAM и по 1 ядру на копию. 10 копий.

---

## Ответ

### Задание. Необходимо определить требуемые ресурсы

Для обеспечения требований проекта необходимо определить ресурсы для каждого компонента приложения с учетом их количества копий и потребления ресурсов. Ниже приведены расчеты и описание необходимых ресурсов:

#### **1. База данных**

- **Количество копий:** 3 (для отказоустойчивости)
- **Ресурсы на одну копию:**
  - **Оперативная память (RAM):** 4 Gb
  - **Процессор (CPU):** 1 ядро
- **Общие ресурсы для базы данных:**
  - **RAM:** 3 копии * 4 Gb = **12 Gb**
  - **CPU:** 3 копии * 1 ядро = **3 ядра**

#### **2. Система кеширования**

- **Количество копий:** 3 (для отказоустойчивости)
- **Ресурсы на одну копию:**
  - **RAM:** 4 Gb
  - **CPU:** 1 ядро
- **Общие ресурсы для кеша:**
  - **RAM:** 3 * 4 Gb = **12 Gb**
  - **CPU:** 3 * 1 ядро = **3 ядра**

#### **3. Фронтенд**

- **Количество копий:** 5
- **Ресурсы на одну копию:**
  - **RAM:** до 50 Mb
  - **CPU:** 0.2 ядра
- **Общие ресурсы для фронтенда:**
  - **RAM:** 5 * 50 Mb = **250 Mb** (0.25 Gb)
  - **CPU:** 5 * 0.2 ядра = **1 ядро**

#### **4. Бекенд**

- **Количество копий:** 10
- **Ресурсы на одну копию:**
  - **RAM:** 600 Mb
  - **CPU:** 1 ядро
- **Общие ресурсы для бекенда:**
  - **RAM:** 10 * 600 Mb = **6000 Mb** (6 Gb)
  - **CPU:** 10 * 1 ядро = **10 ядер**

#### **Общие базовые требования по ресурсам**

- **Общая оперативная память (RAM):**
  - База данных: 12 Gb
  - Кеш: 12 Gb
  - Фронтенд: 0.25 Gb
  - Бекенд: 6 Gb
  - **Всего RAM:** **30.25 Gb**

- **Общее количество процессорных ядер (CPU):**
  - База данных: 3 ядра
  - Кеш: 3 ядра
  - Фронтенд: 1 ядро
  - Бекенд: 10 ядер
  - **Всего CPU:** **17 ядер**

#### **Добавляем запас в 20% для отказоустойчивости**

Чтобы обеспечить работу системы при выходе из строя как минимум одной ноды и иметь дополнительный запас, увеличиваем ресурсы на 20%:

- **RAM с запасом:**
  - 30.25 Gb * 1.2 = **36.3 Gb**
- **CPU с запасом:**
  - 17 ядер * 1.2 = **20.4 ядра**

#### **Характеристики каждой ноды с учетом служебных ресурсов**

Предположим, что каждая нода имеет:

- **Объем RAM:** 16 Gb
- **Количество ядер:** 4 ядра
- **Резерв для служебных нужд:** 20% ресурсов ноды
- **Доступные ресурсы для приложения:**
  - **RAM:** 16 Gb * 0.8 = **12.8 Gb**
  - **CPU:** 4 ядра * 0.8 = **3.2 ядра**

#### **Расчет необходимого количества нод**

**По оперативной памяти (RAM):**
- Требуется: 36.3 Gb
- Доступно на одной ноде: 12.8 Gb
- **Количество нод по RAM:**
  - 36.3 Gb / 12.8 Gb = **2.83**, округляем до **3 нод**

**По процессорным ядрам (CPU):**
- Требуется: 20.4 ядра
- Доступно на одной ноде: 3.2 ядра
- **Количество нод по ядрам:**
  - 20.4 ядер / 3.2 ядра = **6.375**, округляем до **7 нод**

#### **Итоговое количество нод**

Так как нам нужно удовлетворить оба требования (по RAM и по CPU), выбираем большее значение. Поэтому нам необходимо:

- **7 нод** с характеристиками:
  - **RAM:** 16 Gb (12.8 Gb доступно для приложения)
  - **CPU:** 4 ядра (3.2 ядра доступно для приложения)

#### **Заключение**

Для обеспечения требуемых ресурсов с учетом запаса в 20% и резервирования 20% ресурсов каждой ноды для служебных нужд, нам потребуется:

- **7 нод** с указанными выше характеристиками.

Это обеспечит:

- **Общий доступный объем RAM для приложения:**
  - 7 нод * 12.8 Gb = **89.6 Gb** (что превышает требуемые 36.3 Gb с запасом)
- **Общее количество доступных ядер для приложения:**
  - 7 нод * 3.2 ядра = **22.4 ядра** (что превышает требуемые 20.4 ядра с запасом)
- **Отказоустойчивость:**
  - С учетом 7 нод система сможет выдержать выход из строя одной или даже двух нод без потери производительности.
