# Домашнее задание к занятию "`Микросервисы: подходы`" - `Исаенков Евгений`

## Задание

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

---

## Ответ

**Задача 1: Обеспечение процесса разработки**

Для построения надёжного и гибкого CI/CD процесса, который бы удовлетворял всем требованиям, я бы выбрал связку GitLab и Jenkins.

1. **GitLab** — для хранения исходного кода и управления версиями. Этот сервис идеально подходит для микросервисной архитектуры, так как позволяет легко создавать отдельные репозитории для каждого сервиса. GitLab обеспечивает запуск событий при изменении в коде (например, коммит или PR) и предлагает безопасное хранилище для секретных данных, таких как ключи доступа и пароли. Это значит, что все наши данные будут в безопасности, а сборки могут быть запущены при любом изменении, что критично для автоматизации.

2. **Jenkins** — для организации процесса CI/CD. В Jenkins можно настроить сборки по кнопке с параметрами и создать шаблоны для разных типов конфигураций. Jenkins прекрасно справляется с кастомно настроенными шагами в сборке, и мы можем использовать свои Docker-образы для создания нужных окружений для каждого сервиса. Это решение также позволяет разворачивать агентов на собственных серверах, обеспечивая тем самым необходимую гибкость и контроль. Параллельные сборки и запуск тестов обеспечат нам высокую скорость разработки и тестирования.

**Почему GitLab и Jenkins?**  
Эти инструменты отлично интегрируются друг с другом и покрывают все описанные в задаче требования, от контроля версий до гибкой настройки сборок и хранения секретов. Они дают нам полную прозрачность и контроль над процессом CI/CD, что особенно важно при разработке в облачной среде. Так же данная комбинация инструментов позволяет нам легко масштабировать процесс и адаптировать его, если требования изменятся.

---

**Задача 2: Сбор и анализ логов**

Для сбора и анализа логов я бы выбрал решение на базе **ELK-стека (Elasticsearch, Logstash, Kibana)** в связке с **Filebeat**.

1. **Filebeat** будет устанавливаться на каждом хосте, чтобы собирать логи и передавать их в Logstash. Он прост в установке и конфигурации, работает прямо с stdout, что соответствует нашим требованиям к минимальной нагрузке на приложения. Filebeat гарантирует доставку логов до центрального хранилища, даже если возникнут временные проблемы с сетью.

2. **Logstash** используется для предварительной обработки данных. Мы можем настроить его для фильтрации и обогащения логов перед отправкой в Elasticsearch. Это позволяет гибко настроить обработку логов, добавить дополнительные поля или преобразовать данные, чтобы они были в удобном формате для анализа.

3. **Elasticsearch** — центральное хранилище логов. Он не только хранит большие объёмы данных, но и поддерживает быстрый поиск и фильтрацию. Система индексации позволяет эффективно работать с логами даже в случае большого объема данных.

4. **Kibana** — пользовательский интерфейс для визуализации и анализа логов. С его помощью разработчики могут искать нужные записи и фильтровать данные по различным критериям. В Kibana также можно создавать сохранённые запросы и делиться ссылками, что упростит совместную работу с другими участниками команды.

**Почему ELK и Filebeat?**  
Эта связка идеально подходит для централизованного управления логами. Она проста в установке, поддерживает гибкость обработки данных и даёт быстрый доступ к логам через удобный интерфейс. Все компоненты ELK активно поддерживаются и масштабируются под нужды микросервисной архитектуры.

---

**Задача 3: Мониторинг**

Для мониторинга метрик хостов и сервисов я предлагаю использовать связку **Prometheus и Grafana**. Эти инструменты хорошо дополняют друг друга и покрывают все нужные нам функции.

1. **Prometheus** собирает метрики со всех хостов и сервисов. Он поддерживает сбор данных о ресурсах (CPU, RAM, HDD, сеть) и позволяет настроить сбор метрик, специфичных для каждого сервиса. В микросервисной архитектуре это важно, так как мы можем детально отслеживать нагрузку и состояние каждого компонента системы.

2. **Grafana** предоставляет мощный интерфейс для визуализации данных. Она интегрируется с Prometheus и позволяет настраивать дашборды под конкретные нужды. Мы можем агрегировать информацию, настраивать запросы и создавать панели мониторинга, что делает контроль состояния системы более удобным и информативным.

**Почему Prometheus и Grafana?**  
Prometheus — это мощное решение для сбора и хранения метрик, которое легко адаптировать под любые требования. В связке с Grafana оно даёт нам удобный интерфейс для анализа данных, позволяет создавать дашборды и гибко настраивать мониторинг под специфические метрики. Такая система мониторинга надёжна, легко масштабируется, конфигурируется и позволяет следить за состоянием каждого компонента микросервисной архитектуры.